# 出退勤打刻アプリ - セットアップ手順書

## 📋 目次
1. [事前準備](#事前準備)
2. [Google Apps Scriptの設定](#google-apps-scriptの設定)
3. [スプレッドシートの準備](#スプレッドシートの準備)
4. [アプリのデプロイ](#アプリのデプロイ)
5. [スマートフォンでの使用方法](#スマートフォンでの使用方法)
6. [トラブルシューティング](#トラブルシューティング)

---

## 事前準備

### 必要なもの
- Googleアカウント
- LINE Messaging APIのアクセストークン（既に取得済み）
- LINEグループID（既に取得済み）
- スプレッドシートID（既に取得済み）

### 確認済みの情報
```
LINE チャネルアクセストークン:
YOZ7UftinQaO3OyBDaloYu4cXzhYtLzmqBzAGNvCIJRg7h+DoqsX0n6OXdfOFZ9vI7/+VIOKgdWLHJ6yBmeAi6kPqz4+FZ3vpHQTBEAQSHA81c9tQLH/8oP8UUyRpnHxvmJ0QlaAjZWiraJeO38tBgdB04t89/1O/w1cDnyilFU=

グループID:
C5a5b36e27a78ed6cfbb74839a8a9d04e

スプレッドシートID:
1VCsV0AMkzIUBMkvqWFXmQxo3ymqXIZNbK-X8K1XufgM
```

---

## Google Apps Scriptの設定

### ステップ1: スプレッドシートを開く

1. ブラウザで以下のURLにアクセス
   ```
   https://docs.google.com/spreadsheets/d/1VCsV0AMkzIUBMkvqWFXmQxo3ymqXIZNbK-X8K1XufgM/edit
   ```

2. スプレッドシートが開いたら、メニューから「拡張機能」→「Apps Script」をクリック

### ステップ2: GASコードを貼り付け

1. Apps Scriptエディタが開きます
2. デフォルトで表示されている `function myFunction()` のコードを**すべて削除**
3. `Code.gs` ファイルの内容を**すべてコピー**して貼り付け
4. 左上の「💾 保存」ボタンをクリック
5. プロジェクト名を「出退勤管理システム」などに変更（任意）

### ステップ3: Web アプリとしてデプロイ

1. 右上の「デプロイ」ボタン → 「新しいデプロイ」をクリック
2. 「種類の選択」で⚙️アイコンをクリック → 「ウェブアプリ」を選択
3. 以下のように設定：
   - **説明**: 「出退勤管理API v1」（任意）
   - **次のユーザーとして実行**: 「自分」
   - **アクセスできるユーザー**: 「全員」
4. 「デプロイ」ボタンをクリック
5. 「アクセスを承認」をクリック
6. Googleアカウントを選択
7. 「Advanced」→「Go to 出退勤管理システム (unsafe)」をクリック
8. 「Allow」をクリック

### ステップ4: Web App URLをコピー

1. デプロイが完了すると、「ウェブアプリ」の**URL**が表示されます
2. このURLを**必ずメモ**してください（後で使用します）
   ```
   例: https://script.google.com/macros/s/AKfycby.../exec
   ```

---

## スプレッドシートの準備

### ステップ1: ヘッダー行を追加

1. スプレッドシートのA1セルから以下のヘッダーを入力：
   ```
   A1: ユーザーID
   B1: 名前
   C1: 種別
   D1: 出勤時刻
   E1: 退勤時刻
   F1: 勤務時間/URL
   ```

2. ヘッダー行を太字にして、背景色を付けると見やすくなります

### データ例
| ユーザーID | 名前 | 種別 | 出勤時刻 | 退勤時刻 | 勤務時間/URL |
|-----------|------|------|----------|----------|--------------|
| user01 | 田中太郎 | 出勤 | 2025/10/05 09:05 | 2025/10/05 18:10 | 9時間5分 |
| user01 | 田中太郎 | 課題完了 | 2025/10/05 15:30 | | https://... |

---

## アプリのデプロイ

### 方法1: GitHub Pagesを使用（推奨）

#### ステップ1: GitHubリポジトリを作成

1. [GitHub](https://github.com/)にログイン
2. 右上の「+」→「New repository」をクリック
3. リポジトリ名を入力（例: `attendance-app`）
4. 「Public」を選択
5. 「Create repository」をクリック

#### ステップ2: ファイルをアップロード

1. 「uploading an existing file」をクリック
2. 以下のファイルをドラッグ&ドロップ：
   - `index.html`
   - `style.css`
   - `app.js`
   - `manifest.json`
   - `service-worker.js`
   - `icon-192.png`（作成後）
   - `icon-512.png`（作成後）
3. 「Commit changes」をクリック

#### ステップ3: GitHub Pagesを有効化

1. リポジトリのページで「Settings」タブをクリック
2. 左サイドバーの「Pages」をクリック
3. 「Source」で「main」ブランチを選択
4. 「Save」をクリック
5. 数分後、URLが表示されます：
   ```
   https://あなたのユーザー名.github.io/attendance-app/
   ```

### 方法2: Netlifyを使用

1. [Netlify](https://www.netlify.com/)にアクセス
2. 「Sign up」でアカウント作成（GitHubアカウントで連携可能）
3. 「Add new site」→「Deploy manually」
4. フォルダごとドラッグ&ドロップ
5. デプロイ完了後、URLが表示されます

### 方法3: Google Driveを使用（簡易版）

1. Google Driveで新しいフォルダを作成
2. すべてのファイルをアップロード
3. フォルダを右クリック→「共有」→「リンクを知っている全員」
4. ただし、この方法ではPWA機能が制限される可能性があります

---

## スマートフォンでの使用方法

### 初回設定

1. スマートフォンのブラウザ（Chrome/Safari）でアプリのURLを開く
2. 以下の情報を入力：
   - **名前**: あなたの名前（例: 田中太郎）
   - **ユーザーID**: あなたのID（例: user01）
   - **GAS Web App URL**: 先ほどコピーしたGASのURL
3. 情報は自動的に保存されます

### ホーム画面に追加（PWAインストール）

#### iPhoneの場合
1. Safariでアプリを開く
2. 下部の「共有」ボタン（□に↑アイコン）をタップ
3. 「ホーム画面に追加」をタップ
4. 「追加」をタップ

#### Androidの場合
1. Chromeでアプリを開く
2. メニュー（︙）→「ホーム画面に追加」をタップ
3. 「追加」をタップ

### 出勤打刻の使い方

1. ホーム画面のアプリアイコンをタップ
2. 「出勤」ボタンをタップ
3. 打刻が完了すると：
   - 画面に確認メッセージが表示
   - LINEグループに通知が送信
   - スプレッドシートに記録
   - 勤務時間のタイマーが開始

### 退勤打刻の使い方

1. アプリを開く
2. 「退勤」ボタンをタップ
3. 打刻が完了すると：
   - 勤務時間が自動計算
   - LINEグループに通知（勤務時間含む）
   - スプレッドシートに記録

### 課題完了報告の使い方

1. アプリを開く
2. 「アプリURL」欄にあなたのアプリのURLを入力
3. 「課題完了報告」ボタンをタップ
4. LINEグループに報告が送信されます

---

## アイコンの作成

### 方法1: 自動生成ツールを使用

1. `icon-guide.html` をブラウザで開く
2. 「512x512アイコンをダウンロード」ボタンをクリック
3. 「192x192アイコンをダウンロード」ボタンをクリック
4. ダウンロードしたファイルを `icon-512.png` と `icon-192.png` にリネーム
5. 他のファイルと同じフォルダに配置

### 方法2: オンラインツールを使用

- [PWA Builder Image Generator](https://www.pwabuilder.com/imageGenerator)
- [Favicon.io](https://favicon.io/favicon-generator/)

これらのツールで画像をアップロードまたはテキストから生成して、
512x512と192x192のサイズで保存してください。

---

## トラブルシューティング

### LINE通知が届かない

**原因と対策:**

1. **チャネルアクセストークンが間違っている**
   - `Code.gs` の `LINE_ACCESS_TOKEN` を確認
   - LINE Developersコンソールで再確認

2. **グループIDが間違っている**
   - `Code.gs` の `LINE_GROUP_ID` を確認
   - LINEグループにBotが追加されているか確認

3. **Botがグループに追加されていない**
   - LINEグループにBotアカウントを招待
   - LINE Developersコンソールで「Use webhooks」が有効か確認

### スプレッドシートに記録されない

**原因と対策:**

1. **スプレッドシートIDが間違っている**
   - `Code.gs` の `SPREADSHEET_ID` を確認
   - URLから正しいIDをコピー

2. **GASの実行権限がない**
   - GASデプロイ時の承認を再度実行
   - 「自分として実行」を選択しているか確認

### アプリが動作しない

**原因と対策:**

1. **GAS Web App URLが間違っている**
   - アプリの設定画面で正しいURLを入力
   - URLの末尾が `/exec` になっているか確認

2. **HTTPSでアクセスしていない**
   - PWAはHTTPSが必須
   - GitHub PagesやNetlifyを使用する

3. **Service Workerが登録されていない**
   - ブラウザのコンソール（F12）でエラーを確認
   - `service-worker.js` が正しく配置されているか確認

### 出勤ボタンが押せない

**原因と対策:**

1. **入力フィールドが空**
   - 名前、ユーザーID、GAS URLをすべて入力

2. **すでに出勤済み**
   - 退勤してから再度出勤

### PWAとしてインストールできない

**原因と対策:**

1. **HTTPSでアクセスしていない**
   - localhostまたはHTTPS環境が必要

2. **manifest.jsonが読み込まれていない**
   - ブラウザのデベロッパーツールで確認
   - パスが正しいか確認

3. **アイコンがない**
   - 192x192と512x512のアイコンを配置

---

## よくある質問

### Q1: 複数人で使用できますか？
**A:** はい、各自が自分の名前とユーザーIDを入力して使用できます。

### Q2: オフラインでも使用できますか？
**A:** PWAとしてインストールすれば、アプリの起動はオフラインでも可能です。
ただし、打刻の記録にはインターネット接続が必要です。

### Q3: 打刻を間違えた場合は？
**A:** スプレッドシートから直接編集できます。

### Q4: タイムゾーンは日本時間ですか？
**A:** はい、GASのコードで `Asia/Tokyo` に設定しています。

### Q5: GAS URLを変更したい
**A:** アプリの設定画面で新しいURLを入力し直してください。
自動的に保存されます。

---

## セキュリティに関する注意事項

1. **チャネルアクセストークンは秘密情報です**
   - GitHub等に公開する場合は、環境変数化を検討してください
   - 本番環境では、GASのプロパティサービスを使用することを推奨

2. **GAS Web Appの公開設定**
   - 「全員」に公開していますが、社内限定にする場合は設定を変更してください

3. **スプレッドシートの共有設定**
   - 適切なアクセス権限を設定してください

---

## サポート

問題が解決しない場合は、以下を確認してください：
- ブラウザのコンソール（F12）でエラーメッセージを確認
- GASのログ（Apps Scriptエディタの「実行数」タブ）を確認
- LINE Developersコンソールでエラーログを確認

---

## 更新履歴

- 2025/10/30: 初版作成

---

## ライセンス

このアプリはVEXUM研修用として作成されました。
